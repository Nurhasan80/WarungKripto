<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <title>Warung Kripto - Pertukaran</title>
  <style>
      body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f8fa;
      color: #333;
    }
  
  
/* Dark Mode */
body.dark, body.dark header, body.dark .converter-section, body.dark .converter-from, body.dark .from-currency, body.dark input, body.dark .converter-to, body.dark  .conversion-rate, body.dark .bottom-nav {
  background:linear-gradient(180deg,#071228,#04101a);
  color: white;
}

body.dark #to-currency,  body.dark #from-currency {
  background:linear-gradient(180deg,#071228,#04101a);
  color: #007bff;
}
        
    /* Gaya untuk converter section */
    .converter-section {
      padding-top: 120px;
      background-color: #fff;
      margin-bottom: 60px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      
    }
    
    .converter-section header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .converter-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .converter-from, .converter-to {
      flex: 1;
      min-width: 250px;
      padding: 15px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background-color: #f8fafc;
    }
    
    .converter-swap {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #swap-currencies {
      background-color: #1a237e;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      transition: all 0.3s;
    }
    
    #swap-currencies:hover {
      background-color: #303f9f;
      transform: rotate(180deg);
    }
    
    .currency-selector {
      margin-bottom: 10px;
    }
    
    .currency-selector label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #475569;
    }
    
    .currency-selector select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background-color: white;
      font-size: 14px;
    }
    
    .balance-info {
      margin-bottom: 10px;
      font-size: 14px;
      color: #64748b;
    }
    
    .amount-input input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      text-align: left;
    }
    
    .conversion-rate {
      text-align: center;
      margin: 15px 0;
      padding: 10px;
      background-color: #f1f5f9;
      border-radius: 6px;
      font-size: 14px;
      color: #475569;
      display:none;
    }
    
    .converter-action {
      text-align: center;
    }
    
    #convert-button {
      background-color: #10b981;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top:20px;
    }
    
    #convert-button:hover:not(:disabled) {
      background-color: #0d9c6d;
    }
    
    #convert-button:disabled {
      background-color: #cbd5e1;
      cursor: not-allowed;
    }
  
    /* Gaya untuk riwayat konversi */
    .conversion-history {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background-color: #f8fafc;
    }
    
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .history-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }
    
    #clear-history {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    #clear-history:hover {
      background-color: #dc2626;
    }
    
    .history-list {
      max-height: 200px;
      overflow-y: auto;
    }
    
    .history-item {
      padding: 10px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .history-details {
      flex: 1;
    }
    
    .history-amount {
      font-weight: 600;
      color: #1e293b;
    }
    
    .history-date {
      font-size: 12px;
      color: #64748b;
    }
    
    .empty-history {
      text-align: center;
      padding: 20px;
      color: #64748b;
      font-style: italic;
    }
    
    /* Dark mode untuk riwayat */
    body.dark .conversion-history,
    body.dark .history-item {
      background:linear-gradient(180deg,#071228,#04101a);
      color: white;
      border-color: #334155;
    }
    
    body.dark .history-header h3 {
      color: white;
    }
    
    body.dark .history-amount {
      color: white;
    }
    
    body.dark .history-date {
      color: #cbd5e1;
    }
  
  /* menu bawah mobile*/
  .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);

      z-index: 999;
    }

    .bottom-nav a {
      flex: 1;
      text-align: center;
      color: #555;
      font-size: 12px;
      text-decoration: none;
      transition: color 0.3s ease, transform 0.2s ease;
    }

    .bottom-nav a i {
      font-size: 20px;
      display: block;
      margin-bottom: 3px;
    }



    .bottom-nav a.hovering {
      color:#3498db !important;
      transform: scale(1.1);
    }
    .bottom-nav a:hover {
      color:#3498db ;
      transform: scale(1.1);
    }
  .swap i {
    color:#3498db;
  }


    /* kotak pesan */
    .overlayMsg {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: rgba(0, 0, 0, 0.4);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .message-box {
      background-color: #fff;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      text-align: center;
      max-width: 350px;
      width: 50%;
      position: relative;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .message-box .icon {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .message-box h3 {
      margin: 10px 0 5px;
    }

    .message-box p {
      margin: 0 0 15px;
    }

    .close-btn {
      background-color: #444;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    .close-btn:hover {
      background-color: #222;
    }

    /* Tipe pesan */
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .warning { color: #ffc107; }
    .info { color: #007bff; }
  
      @media (min-width: 768px) {
      .bottom-nav {
        display: none;
      }
    }
    
    @media (max-width: 768px) {
      .converter-container {
        flex-direction: column;
      }
      
      .converter-swap {
        margin: 10px 0;
        transform: rotate(90deg);
      }
      .converter-section {
      padding: 20px;
      background-color: #fff;
      margin-top: 50px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
   
    }
  
  </style>
</head>
<body>
<!-- Header fixed dengan RGBA -->
  <header style="background-color: rgba(0, 123, 255, 1);" 
          class="fixed top-0 left-0 w-full z-50 py-4 text-center text-xl font-semibold text-white shadow-md">

    <!-- Back Arrow muncul di tablet & desktop (≥640px) -->
    <a href="index.html" 
       class="absolute top-1/2 left-4 -translate-y-1/2 items-center text-white hover:text-gray-200 hidden sm:flex">
      <svg xmlns="http://www.w3.org/2000/svg" 
           class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </a>
   <i class="fas fa-exchange-alt"></i> Pertukaran
  </header>
 

  <!-- Section Converter Mata Uang Cryptocurrency -->
  <section class="converter-section">
    
    <div class="converter-container">
      <div class="converter-from">
        <div class="currency-selector">
          <label>Dari:</label>
          <select id="from-currency">
            <option value="idr">IDR (Rupiah)</option>
            <option value="usd">USD (Dollar AS)</option>
            <!-- Opsi cryptocurrency akan diisi oleh JavaScript -->
          </select>
        </div>
        <div class="balance-info">
          <span>Saldo: </span>
          <span id="from-balance">Rp 0</span>
        </div>
        <div class="amount-input">
          <input type="number" id="from-amount" placeholder="Masukan Jumlah saldo (Min Rp 10.000)" min="0" step="0.00000001">
        </div>
      </div>
      
      <div class="converter-swap">
        <button id="swap-currencies">
          <i class="fas fa-exchange-alt"></i>
        </button>
      </div>
      
      <div class="converter-to">
        <div class="currency-selector">
          <label>Ke:</label>
          <select id="to-currency">
            <option value="usd">USD (Dollar AS)</option>
            <option value="idr">IDR (Rupiah)</option>
            <!-- Opsi cryptocurrency akan diisi oleh JavaScript -->
          </select>
        </div>
        <div class="balance-info">
          <span>Saldo: </span>
          <span id="to-balance">$0.00</span>
        </div>
        <div class="amount-input">
          <input type="number" id="to-amount" placeholder="Hasil" readonly>
        </div>
      </div>
    </div>
    
    <div class="conversion-rate">
      <span id="rate-info">Kurs: 1 IDR = 0.000067 USD</span>
    </div>
    
    <div class="converter-action">
      <button id="convert-button" disabled>Konversi Sekarang</button>
    </div>
    
    <!-- Kotak Riwayat Konversi -->
    <div class="conversion-history">
      <div class="history-header">
        <h3>Riwayat Konversi</h3>
        <button id="clear-history">Hapus Riwayat</button>
      </div>
      <div class="history-list" id="history-list">
        <!-- Riwayat akan diisi oleh JavaScript -->
        <div class="empty-history">Belum ada riwayat konversi</div>
      </div>
    </div>
  </section>
  
      <!-- Kotak pesan -->
  <div id="overlayMsg" class="overlayMsg">
    <div id="messageBox" class="message-box">
      <div id="icon" class="icon">ℹ️</div>
      <h3 id="messageTitle">Judul</h3>
      <p id="messageText">Isi pesan</p>
      <button class="close-btn" onclick="hideMessage()">Tutup</button>
    </div>
  </div>
  
  <nav class="bottom-nav">
    <div class="home">
    <a href="index.html" class="nav-item active">
      
      <i class="fas fa-home"></i>
      Beranda
    </a>
      </div>
    
<div class="pasar">
    <a href="pasar.html" class="nav-item">
      <i class="fa-solid fa-chart-simple"></i>
      Pasar
    </a> 
</div>
    
<div class="trading">
    <a href="trading.html" class="nav-item">
      <i class="fa-solid fa-money-bill-trend-up"></i>
      Perdagangan
    </a>
</div>
    
    <div class="swap">  
    <a href="swap.html" class="nav-item">
      <i class="fas fa-exchange-alt"></i> 
      Pertukaran
    </a>
    </div>
    
<div class="dompet">
    <a href="wallet.html" class="nav-item">
      <i class="fa-solid fa-wallet"></i>
      Dompet
    </a>
</div>
    
  </nav>

<script src="themes.js"></script>
  <script>
  // Variabel global untuk menyimpan data cryptocurrency
  let cryptoData = [];
  let exchangeRate = 15000; // Nilai tukar default (akan diupdate via API)
  let currentConversionResult = 0;
  // Saldo pengguna untuk masing-masing mata uang
  let userBalance = {
    usd: 0, // Saldo default USD
    idr: 0 // Saldo default IDR (1 juta)
  };
  
  let userCoins = {}; // Menyimpan jumlah koin yang dimiliki pengguna
  let conversionHistory = []; // Menyimpan riwayat konversi

  // Fungsi untuk mendapatkan nilai tukar IDR ke USD
  async function getExchangeRate() {
    try {
      const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
      const data = await response.json();
      exchangeRate = data.rates.IDR;
    } catch (error) {
      console.error('Error fetching exchange rate, using default:', error);
      // Fallback ke nilai default jika API tidak tersedia
      exchangeRate = 15000;
    }
  }

  // Fungsi untuk memuat data dari localStorage
  function loadFromLocalStorage() {
    const savedBalance = localStorage.getItem('cryptoUserBalance');
    const savedCoins = localStorage.getItem('cryptoUserCoins');
    const savedHistory = localStorage.getItem('conversionHistory');
    
    if (savedBalance) {
      userBalance = JSON.parse(savedBalance);
    }
    
    if (savedCoins) {
      userCoins = JSON.parse(savedCoins);
    }
    
    if (savedHistory) {
      conversionHistory = JSON.parse(savedHistory);
      renderConversionHistory();
    }
    
    updateBalanceDisplay();
  }

  // Fungsi untuk menyimpan data ke localStorage
  function saveToLocalStorage() {
    localStorage.setItem('cryptoUserBalance', JSON.stringify(userBalance));
    localStorage.setItem('cryptoUserCoins', JSON.stringify(userCoins));
    localStorage.setItem('conversionHistory', JSON.stringify(conversionHistory));
  }

  // Fungsi untuk memuat data cryptocurrency
  function loadCryptoData() {
    const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1`;

    fetch(url)
    .then(response => response.json())
    .then(data => {
      cryptoData = data;
      // Setelah data crypto dimuat, isi dropdown converter
      populateCurrencyDropdowns();
      updateBalanceDisplay();
    })
    .catch(err => console.error('Error loading crypto data:', err));
  }

  // Fungsi untuk mengisi dropdown dengan cryptocurrency
  function populateCurrencyDropdowns() {
    const fromDropdown = document.getElementById('from-currency');
    const toDropdown = document.getElementById('to-currency');
    
    // Simpan nilai yang dipilih sebelumnya
    const previousFromValue = fromDropdown.value;
    const previousToValue = toDropdown.value;
    
    // Hapus opsi crypto yang sudah ada (kecuali IDR dan USD)
    const fromOptions = fromDropdown.querySelectorAll('option:not([value="idr"]):not([value="usd"])');
    const toOptions = toDropdown.querySelectorAll('option:not([value="idr"]):not([value="usd"])');
    
    fromOptions.forEach(option => option.remove());
    toOptions.forEach(option => option.remove());
    
    // Tambahkan cryptocurrency ke dropdown
    cryptoData.forEach(coin => {
      const fromOption = document.createElement('option');
      fromOption.value = coin.id;
      fromOption.textContent = `${coin.symbol.toUpperCase()} (${coin.name})`;
      
      const toOption = document.createElement('option');
      toOption.value = coin.id;
      toOption.textContent = `${coin.symbol.toUpperCase()} (${coin.name})`;
      
      fromDropdown.appendChild(fromOption);
      toDropdown.appendChild(toOption);
    });
    
    // Kembalikan nilai yang dipilih sebelumnya jika masih ada
    if (previousFromValue && fromDropdown.querySelector(`option[value="${previousFromValue}"]`)) {
      fromDropdown.value = previousFromValue;
    }
    
    if (previousToValue && toDropdown.querySelector(`option[value="${previousToValue}"]`)) {
      toDropdown.value = previousToValue;
    }
    
    // Perbarui tampilan setelah dropdown diisi
    updateBalanceDisplay();
    calculateConversion();
  }
  
  // Fungsi untuk menginisialisasi converter
  function initConverter() {
    // Event listener untuk swap currencies
    document.getElementById('swap-currencies').addEventListener('click', swapCurrencies);
    
    // Event listener untuk perubahan input amount
    document.getElementById('from-amount').addEventListener('input', calculateConversion);
    
    // Event listener untuk perubahan mata uang
    document.getElementById('from-currency').addEventListener('change', function() {
      updateBalanceDisplay();
      calculateConversion();
    });
    
    document.getElementById('to-currency').addEventListener('change', function() {
      updateBalanceDisplay();
      calculateConversion();
    });
    
    // Event listener untuk tombol konversi
    document.getElementById('convert-button').addEventListener('click', performConversion);
    
    // Event listener untuk tombol hapus riwayat
    document.getElementById('clear-history').addEventListener('click', clearConversionHistory);
    
    // Inisialisasi tampilan
    updateBalanceDisplay();
  }
  
  // Fungsi untuk menukar mata uang
  function swapCurrencies() {
    const fromCurrency = document.getElementById('from-currency');
    const toCurrency = document.getElementById('to-currency');
    const fromAmount = document.getElementById('from-amount');
    const toAmount = document.getElementById('to-amount');
    
    // Simpan nilai sementara
    const tempCurrency = fromCurrency.value;
    const tempAmount = fromAmount.value;
    
    // Tukar nilai
    fromCurrency.value = toCurrency.value;
    toCurrency.value = tempCurrency;
    
    // Tukar amount jika ada nilai
    if (tempAmount) {
      fromAmount.value = toAmount.value;
      calculateConversion();
    }
    
    // Perbarui tampilan saldo
    updateBalanceDisplay();
  }
  
  // Fungsi untuk memperbarui tampilan saldo
// FUNGSI INI JUGA PERLU DIPERBAIKI UNTUK KONSISTENSI
function updateBalanceDisplay() {
  const fromCurrency = document.getElementById('from-currency').value;
  const toCurrency = document.getElementById('to-currency').value;
  const fromBalanceElement = document.getElementById('from-balance');
  const toBalanceElement = document.getElementById('to-balance');
  
  // Tampilkan saldo untuk mata uang asal (DIPERBAIKI)
  if (fromCurrency === 'idr') {
    fromBalanceElement.textContent = `Rp ${Math.round(userBalance.idr).toLocaleString('id-ID')}`;
  } else if (fromCurrency === 'usd') {
    fromBalanceElement.textContent = `$${userBalance.usd.toFixed(2)}`;
  } else {
    // Crypto currency
    const coinAmount = userCoins[fromCurrency] || 0;
    fromBalanceElement.textContent = `${coinAmount.toFixed(6)} ${getCurrencySymbol(fromCurrency)}`;
  }
  
  // Tampilkan saldo untuk mata uang tujuan (DIPERBAIKI)
  if (toCurrency === 'idr') {
    toBalanceElement.textContent = `Rp ${Math.round(userBalance.idr).toLocaleString('id-ID')}`;
  } else if (toCurrency === 'usd') {
    toBalanceElement.textContent = `$${userBalance.usd.toFixed(2)}`;
  } else {
    // Crypto currency
    const coinAmount = userCoins[toCurrency] || 0;
    toBalanceElement.textContent = `${coinAmount.toFixed(6)} ${getCurrencySymbol(toCurrency)}`;
  }
  
  // Periksa apakah konversi dimungkinkan
  checkConversionPossible();
}
  
  // Fungsi untuk memeriksa apakah konversi dimungkinkan
  function checkConversionPossible() {
    const fromCurrency = document.getElementById('from-currency').value;
    const toCurrency = document.getElementById('to-currency').value;
    const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
    const convertButton = document.getElementById('convert-button');
    
    // Tidak boleh mengkonversi ke mata uang yang sama
    if (fromCurrency === toCurrency) {
      convertButton.disabled = true;
      return;
    }
    
    // Periksa apakah ada saldo yang cukup
    let hasEnoughBalance = false;
    
    if (fromCurrency === 'idr') {
      hasEnoughBalance = userBalance.idr >= fromAmount;
    } else if (fromCurrency === 'usd') {
      hasEnoughBalance = userBalance.usd >= fromAmount;
    } else {
      // Crypto currency
      const coinAmount = userCoins[fromCurrency] || 0;
      hasEnoughBalance = coinAmount >= fromAmount;
    }
    
    convertButton.disabled = !hasEnoughBalance || fromAmount <= 0;
  }
  
  // Fungsi untuk menghitung konversi
  function calculateConversion() {
    const fromCurrency = document.getElementById('from-currency').value;
    const toCurrency = document.getElementById('to-currency').value;
    const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
    const toAmountElement = document.getElementById('to-amount');
    const rateInfoElement = document.getElementById('rate-info');
    
    // Reset jika amount 0
    if (fromAmount <= 0) {
      toAmountElement.value = '';
      rateInfoElement.textContent = 'Masukkan jumlah untuk melihat kurs';
      checkConversionPossible();
      return;
    }
    
    // Tidak boleh mengkonversi ke mata uang yang sama
    if (fromCurrency === toCurrency) {
      toAmountElement.value = fromAmount;
      rateInfoElement.textContent = 'Mata uang asal dan tujuan tidak boleh sama';
      checkConversionPossible();
      return;
    }
    
    // Hitung nilai konversi
    let rate = 0;
    let result = 0;
    
    // Konversi dari IDR
    if (fromCurrency === 'idr') {
      if (toCurrency === 'usd') {
        // IDR ke USD
        rate = 1 / exchangeRate;
        result = fromAmount * rate;
        rateInfoElement.textContent = `Kurs: 1 IDR = ${rate.toFixed(6)} USD`;
      } else {
        // IDR ke Crypto
        const coin = cryptoData.find(c => c.id === toCurrency);
        if (coin) {
          const priceInUSD = coin.current_price;
          const priceInIDR = priceInUSD * exchangeRate;
          rate = 1 / priceInIDR;
          result = fromAmount * rate;
          rateInfoElement.textContent = `Kurs: 1 IDR = ${rate.toFixed(8)} ${coin.symbol.toUpperCase()}`;
        }
      }
    }
    // Konversi dari USD
    else if (fromCurrency === 'usd') {
      if (toCurrency === 'idr') {
        // USD ke IDR
        rate = exchangeRate;
        result = fromAmount * rate;
        rateInfoElement.textContent = `Kurs: 1 USD = ${rate.toFixed(2)} IDR`;
      } else {
        // USD ke Crypto
        const coin = cryptoData.find(c => c.id === toCurrency);
        if (coin) {
          const priceInUSD = coin.current_price;
          rate = 1 / priceInUSD;
          result = fromAmount * rate;
          rateInfoElement.textContent = `Kurs: 1 USD = ${rate.toFixed(6)} ${coin.symbol.toUpperCase()}`;
        }
      }
    }
    // Konversi dari Crypto
    else {
      const fromCoin = cryptoData.find(c => c.id === fromCurrency);
      
      if (toCurrency === 'idr') {
        // Crypto ke IDR
        if (fromCoin) {
          const priceInUSD = fromCoin.current_price;
          const priceInIDR = priceInUSD * exchangeRate;
          rate = priceInIDR;
          result = fromAmount * rate;
          rateInfoElement.textContent = `Kurs: 1 ${fromCoin.symbol.toUpperCase()} = ${rate.toFixed(2)} IDR`;
        }
      } else if (toCurrency === 'usd') {
        // Crypto ke USD
        if (fromCoin) {
          const priceInUSD = fromCoin.current_price;
          rate = priceInUSD;
          result = fromAmount * rate;
          rateInfoElement.textContent = `Kurs: 1 ${fromCoin.symbol.toUpperCase()} = ${rate.toFixed(2)} USD`;
        }
      } else {
        // Crypto ke Crypto
        const fromCoin = cryptoData.find(c => c.id === fromCurrency);
        const toCoin = cryptoData.find(c => c.id === toCurrency);
        
        if (fromCoin && toCoin) {
          const fromPriceInUSD = fromCoin.current_price;
          const toPriceInUSD = toCoin.current_price;
          rate = fromPriceInUSD / toPriceInUSD;
          result = fromAmount * rate;
          rateInfoElement.textContent = `Kurs: 1 ${fromCoin.symbol.toUpperCase()} = ${rate.toFixed(6)} ${toCoin.symbol.toUpperCase()}`;
        }
      }
    }
    
    // Tampilkan hasil
       // Tampilkan hasil dengan format yang sesuai
       toAmountElement.value = formatCurrencyAmount(result, toCurrency);
    
    // Periksa apakah konversi dimungkinkan
    checkConversionPossible();
  }

  // Fungsi pembantu untuk memformat angka berdasarkan mata uang
// Fungsi pembantu untuk memformat angka berdasarkan mata uang (DIPERBAIKI)
function formatCurrencyAmount(amount, currencyCode) {
  if (currencyCode === 'idr') {
    // Untuk IDR, tampilkan tanpa desimal dan tanpa pemisah ribuan
    return Math.round(amount).toString();
  } else if (currencyCode === 'usd') {
    // Untuk USD, tampilkan 2 desimal
    return amount.toFixed(2);
  } else {
    // Untuk cryptocurrency, tampilkan 6 desimal
    return amount.toFixed(6);
  }
}
  
  // Fungsi untuk melakukan konversi
  function performConversion() {
  const fromCurrency = document.getElementById('from-currency').value;
  const toCurrency = document.getElementById('to-currency').value;
  const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
  const toAmount = parseFloat(document.getElementById('to-amount').value) || 0;

  if (fromAmount <= 0) {
    showMessage('Kesalahan', 'Terjadi error sistem!', 'error');
    return;
  }

  // 🔹 Validasi batas minimal konversi
  if (fromCurrency === 'idr' && fromAmount < 10000) {
    showMessage('Validasi Gagal', 'Minimal konversi IDR adalah Rp 10.000', 'warning');
    return;
  }

  if (fromCurrency === 'usd' && fromAmount < 1) {
    showMessage('Validasi Gagal', 'Minimal konversi USD adalah $1', 'warning');
    return;
  }

  // Kurangi saldo mata uang asal
  if (fromCurrency === 'idr') {
    userBalance.idr -= fromAmount;
  } else if (fromCurrency === 'usd') {
    userBalance.usd -= fromAmount;
  } else {
    if (!userCoins[fromCurrency]) userCoins[fromCurrency] = 0;
    userCoins[fromCurrency] -= fromAmount;
    if (userCoins[fromCurrency] <= 0) {
      delete userCoins[fromCurrency];
    }
  }

  // Tambahkan saldo tujuan
  if (toCurrency === 'idr') {
    userBalance.idr += toAmount;
  } else if (toCurrency === 'usd') {
    userBalance.usd += toAmount;
  } else {
    if (!userCoins[toCurrency]) userCoins[toCurrency] = 0;
    userCoins[toCurrency] += toAmount;
  }

  // Tambahkan ke riwayat konversi
  addToConversionHistory(fromCurrency, toCurrency, fromAmount, toAmount);

  // Simpan ke localStorage
  saveToLocalStorage();

  // Perbarui tampilan saldo
  updateBalanceDisplay();

    // Tampilkan pesan sukses dengan format yang sesuai
    const formattedFromAmount = formatCurrencyAmount(fromAmount, fromCurrency);
  const formattedToAmount = formatCurrencyAmount(toAmount, toCurrency);
  showMessage('Sukses', `Konversi berhasil! ${formattedFromAmount} ${getCurrencyName(fromCurrency)} telah dikonversi menjadi ${formattedToAmount} ${getCurrencyName(toCurrency)}`, 'success');

  // Reset form
  document.getElementById('from-amount').value = '';
  document.getElementById('to-amount').value = '';
  document.getElementById('rate-info').textContent = 'Masukkan jumlah untuk melihat kurs';

  // Nonaktifkan tombol konversi
  document.getElementById('convert-button').disabled = true;
}

  // Fungsi untuk menambahkan konversi ke riwayat
  function addToConversionHistory(fromCurrency, toCurrency, fromAmount, toAmount) {
    const conversion = {
      id: Date.now(),
      fromCurrency: fromCurrency,
      toCurrency: toCurrency,
      fromAmount: fromAmount,
      toAmount: toAmount,
      date: new Date().toLocaleString('id-ID')
    };
    
    // Tambahkan di awal array agar yang terbaru muncul di atas
    conversionHistory.unshift(conversion);
    
    // Batasi riwayat hanya 10 item terbaru
    if (conversionHistory.length > 10) {
      conversionHistory = conversionHistory.slice(0, 10);
    }
    
    // Render ulang riwayat
    renderConversionHistory();
  }
  
  // Fungsi untuk merender riwayat konversi
  // 🔹 Fungsi bantu untuk memformat angka agar tidak muncul nol berlebih
function formatNumber(value) {
  // Jika angkanya bulat, tampilkan tanpa koma
  if (Number.isInteger(value)) return value.toString();
  // Jika desimal, tampilkan maksimal 6 angka di belakang koma tapi tanpa nol berlebih
  return parseFloat(value.toFixed(6)).toString();
}

// 🔹 Fungsi untuk merender riwayat konversi (versi rapi)
// 🔹 Fungsi untuk merender riwayat konversi (versi rapi)
function renderConversionHistory() {
  const historyList = document.getElementById('history-list');
  
  // Kosongkan daftar riwayat terlebih dahulu
  historyList.innerHTML = '';
  
  if (conversionHistory.length === 0) {
    historyList.innerHTML = '<div class="empty-history">Belum ada riwayat konversi</div>';
    return;
  }

  // Tambahkan setiap item riwayat
  conversionHistory.forEach(item => {
    const historyItem = document.createElement('div');
    historyItem.className = 'history-item';
    
    const fromSymbol = getCurrencySymbol(item.fromCurrency);
    const toSymbol = getCurrencySymbol(item.toCurrency);
    
    // Format jumlah dengan fungsi formatCurrencyAmount
    const formattedFromAmount = formatCurrencyAmount(item.fromAmount, item.fromCurrency);
    const formattedToAmount = formatCurrencyAmount(item.toAmount, item.toCurrency);
    
    historyItem.innerHTML = `
      <div class="history-details">
        <div class="history-amount">
          ${formattedFromAmount} ${fromSymbol} → ${formattedToAmount} ${toSymbol}
        </div>
        <div class="history-date">${item.date}</div>
      </div>
    `;
    
    historyList.appendChild(historyItem);
  });
}

  
  // Fungsi untuk menghapus riwayat konversi
  function clearConversionHistory() {
    if (conversionHistory.length === 0) {
      showMessage('Info', 'Tidak ada riwayat untuk dihapus', 'info');
      return;
    }
    
    if (confirm('Apakah Anda yakin ingin menghapus semua riwayat konversi?')) {
      conversionHistory = [];
      renderConversionHistory();
      saveToLocalStorage();
      showMessage('Sukses', 'Riwayat konversi berhasil dihapus', 'success');
    }
  }
  
  // Fungsi pembantu untuk mendapatkan nama mata uang
  function getCurrencyName(currencyCode) {
    if (currencyCode === 'idr') return 'IDR';
    if (currencyCode === 'usd') return 'USD';
    
    const coin = cryptoData.find(c => c.id === currencyCode);
    return coin ? coin.symbol.toUpperCase() : currencyCode.toUpperCase();
  }
  
  // Fungsi pembantu untuk mendapatkan simbol mata uang
  function getCurrencySymbol(currencyCode) {
    if (currencyCode === 'idr') return 'IDR';
    if (currencyCode === 'usd') return 'USD';
    
    const coin = cryptoData.find(c => c.id === currencyCode);
    return coin ? coin.symbol.toUpperCase() : currencyCode.toUpperCase();
  }
  
  // Inisialisasi aplikasi
  async function initApp() {
    await getExchangeRate();
    loadFromLocalStorage();
    await loadCryptoData();
    initConverter();
  }
  
  // Jalankan aplikasi
  initApp();
  
  // menu bawah mobile
  
  const navItems = document.querySelectorAll(".nav-item");

    navItems.forEach(item => {
      item.addEventListener("mouseenter", () => {
        navItems.forEach(i => i.classList.remove("hovering", "active"));
        item.classList.add("hovering");
      });

      item.addEventListener("mouseleave", () => {
        navItems.forEach(i => i.classList.remove("hovering"));
        document.querySelector(".nav-item.home").classList.add("active");
      });
    });

    // Tambahkan kelas pembeda agar tahu mana home
    document.querySelector(".nav-item").classList.add("home");


// scrip kotak pesan
    let autoCloseTimeout;

    function showMessage(title, text, type = 'info') {
      const overlayMsg = document.getElementById('overlayMsg');
      const titleEl = document.getElementById('messageTitle');
      const textEl = document.getElementById('messageText');
      const iconEl = document.getElementById('icon');
      const box = document.getElementById('messageBox');

      // Reset kelas warna lama
      box.classList.remove('success', 'error', 'warning', 'info');

      // Ikon & warna berdasarkan tipe
      const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
      };

      iconEl.textContent = icons[type] || 'ℹ️';
      box.classList.add(type);
      titleEl.textContent = title;
      textEl.textContent = text;

      overlayMsg.style.display = 'flex';

      // Auto close setelah 4 detik
      clearTimeout(autoCloseTimeout);
      autoCloseTimeout = setTimeout(() => {
        hideMessage();
      }, 4000);
    }

    function hideMessage() {
      document.getElementById('overlayMsg').style.display = 'none';
    }


    // fungsi validatasi konversi
    
  </script>
</body>
</html>
